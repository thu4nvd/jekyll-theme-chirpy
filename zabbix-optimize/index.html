<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="📯 Zabbix - Tối ưu hóa Zabbix + MySQL" /><meta name="author" content="thu4nvd" /><meta property="og:locale" content="en_US" /><meta name="description" content="Sau khi các bạn cài đặt Zabbix trên CentOS hoàn thành để cho hệ thống Zabbix server hoạt động với hiệu năng cao nhất thì các bạn cần thực hiện các bước tối ưu hóa Zabbix server và MySQL database. Nếu chưa xem bài viết “Cài đặt Zabbix trên CentOS” thì các bạn tham khảo tại đây: Hướng dẫn cài đặt Zabbix. Hướng dẫn các bước tối ưu hóa Zabbix server và MySQL database Bước 1: Tạo phân vùng MySQL trên Lịch sử và bảng Sự kiện Quy trình housekeeping của Zabbix chịu trách nhiệm xóa dữ liệu lịch sử. Xóa dữ liệu cũ khỏi database bằng cách sử dụng truy vấn xóa SQL, hành động này tác động tiêu cực đến hiệu suất database, có thể sẽ nhận được thông báo “Zabbix housekeeper processes more than 75% busy” vì điều đó. Vấn đề này có thể được giải quyết với việc phân vùng cơ sở dữ liệu. Phân vùng tạo ra các bảng cho mỗi giờ hoặc mỗi ngày và loại bỏ chúng khi không cần thiết. SQL DROP hiệu quả hơn câu lệnh DELETE. Bạn có thể phân vùng các bảng MySQL bằng cách sử dụng&nbsp;hướng dẫn đơn giản này: Tạo phân vùng database Zabbix trên MySQL MariaDB Bước 2: Tối ưu hóa Zabbix Server Nếu bạn đang vận hành với số lượng ít thiết bị thì bạn có thể bỏ qua bước này, còn nếu hệ thống của bạn lớn bao gồm nhiều thiết bị thì tiếp tục thực hiện tiếp nào. Mở&nbsp;file “zabbix_server.conf” bằng lệnh “ nano /etc/zabbix/zabbix_server.conf” và thêm cấu hình dưới vào bất kỳ đâu trong file: StartPollers=100 StartPollersUnreachable=50 StartPingers=50 StartTrappers=10 StartDiscoverers=15 StartPreprocessors=15 StartHTTPPollers=5 StartAlerters=5 StartTimers=2 StartEscalators=2 CacheSize=128M HistoryCacheSize=64M HistoryIndexCacheSize=32M TrendCacheSize=32M ValueCacheSize=256M Lưu và thoát file (&nbsp;ctrl&nbsp;+&nbsp;x&nbsp;, tiếp theo là&nbsp;&nbsp;y&nbsp;&nbsp;và&nbsp;&nbsp;enter&nbsp;). Bước 3: Tối ưu hóa MySQL/MariaDB database a. Tạo file cấu hình MySQL Tạo file “10_my_tweaks.cnf”&nbsp;bằng lệnh “nano /etc/my.cnf.d/10_my_tweaks.cnf” và thêm cấu hình dưới vào: [mysqld] max_connections = 404 innodb_buffer_pool_size = 800M" /><meta property="og:description" content="Sau khi các bạn cài đặt Zabbix trên CentOS hoàn thành để cho hệ thống Zabbix server hoạt động với hiệu năng cao nhất thì các bạn cần thực hiện các bước tối ưu hóa Zabbix server và MySQL database. Nếu chưa xem bài viết “Cài đặt Zabbix trên CentOS” thì các bạn tham khảo tại đây: Hướng dẫn cài đặt Zabbix. Hướng dẫn các bước tối ưu hóa Zabbix server và MySQL database Bước 1: Tạo phân vùng MySQL trên Lịch sử và bảng Sự kiện Quy trình housekeeping của Zabbix chịu trách nhiệm xóa dữ liệu lịch sử. Xóa dữ liệu cũ khỏi database bằng cách sử dụng truy vấn xóa SQL, hành động này tác động tiêu cực đến hiệu suất database, có thể sẽ nhận được thông báo “Zabbix housekeeper processes more than 75% busy” vì điều đó. Vấn đề này có thể được giải quyết với việc phân vùng cơ sở dữ liệu. Phân vùng tạo ra các bảng cho mỗi giờ hoặc mỗi ngày và loại bỏ chúng khi không cần thiết. SQL DROP hiệu quả hơn câu lệnh DELETE. Bạn có thể phân vùng các bảng MySQL bằng cách sử dụng&nbsp;hướng dẫn đơn giản này: Tạo phân vùng database Zabbix trên MySQL MariaDB Bước 2: Tối ưu hóa Zabbix Server Nếu bạn đang vận hành với số lượng ít thiết bị thì bạn có thể bỏ qua bước này, còn nếu hệ thống của bạn lớn bao gồm nhiều thiết bị thì tiếp tục thực hiện tiếp nào. Mở&nbsp;file “zabbix_server.conf” bằng lệnh “ nano /etc/zabbix/zabbix_server.conf” và thêm cấu hình dưới vào bất kỳ đâu trong file: StartPollers=100 StartPollersUnreachable=50 StartPingers=50 StartTrappers=10 StartDiscoverers=15 StartPreprocessors=15 StartHTTPPollers=5 StartAlerters=5 StartTimers=2 StartEscalators=2 CacheSize=128M HistoryCacheSize=64M HistoryIndexCacheSize=32M TrendCacheSize=32M ValueCacheSize=256M Lưu và thoát file (&nbsp;ctrl&nbsp;+&nbsp;x&nbsp;, tiếp theo là&nbsp;&nbsp;y&nbsp;&nbsp;và&nbsp;&nbsp;enter&nbsp;). Bước 3: Tối ưu hóa MySQL/MariaDB database a. Tạo file cấu hình MySQL Tạo file “10_my_tweaks.cnf”&nbsp;bằng lệnh “nano /etc/my.cnf.d/10_my_tweaks.cnf” và thêm cấu hình dưới vào: [mysqld] max_connections = 404 innodb_buffer_pool_size = 800M" /><link rel="canonical" href="https://thu4nvd.github.io//zabbix-optimize/" /><meta property="og:url" content="https://thu4nvd.github.io//zabbix-optimize/" /><meta property="og:site_name" content="Thu4nvd Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-05T05:36:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="📯 Zabbix - Tối ưu hóa Zabbix + MySQL" /><meta name="twitter:site" content="@thu4nvd" /><meta name="twitter:creator" content="@thu4nvd" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"thu4nvd"},"description":"Sau khi các bạn cài đặt Zabbix trên CentOS hoàn thành để cho hệ thống Zabbix server hoạt động với hiệu năng cao nhất thì các bạn cần thực hiện các bước tối ưu hóa Zabbix server và MySQL database. Nếu chưa xem bài viết “Cài đặt Zabbix trên CentOS” thì các bạn tham khảo tại đây: Hướng dẫn cài đặt Zabbix. Hướng dẫn các bước tối ưu hóa Zabbix server và MySQL database Bước 1: Tạo phân vùng MySQL trên Lịch sử và bảng Sự kiện Quy trình housekeeping của Zabbix chịu trách nhiệm xóa dữ liệu lịch sử. Xóa dữ liệu cũ khỏi database bằng cách sử dụng truy vấn xóa SQL, hành động này tác động tiêu cực đến hiệu suất database, có thể sẽ nhận được thông báo “Zabbix housekeeper processes more than 75% busy” vì điều đó. Vấn đề này có thể được giải quyết với việc phân vùng cơ sở dữ liệu. Phân vùng tạo ra các bảng cho mỗi giờ hoặc mỗi ngày và loại bỏ chúng khi không cần thiết. SQL DROP hiệu quả hơn câu lệnh DELETE. Bạn có thể phân vùng các bảng MySQL bằng cách sử dụng&nbsp;hướng dẫn đơn giản này: Tạo phân vùng database Zabbix trên MySQL MariaDB Bước 2: Tối ưu hóa Zabbix Server Nếu bạn đang vận hành với số lượng ít thiết bị thì bạn có thể bỏ qua bước này, còn nếu hệ thống của bạn lớn bao gồm nhiều thiết bị thì tiếp tục thực hiện tiếp nào. Mở&nbsp;file “zabbix_server.conf” bằng lệnh “ nano /etc/zabbix/zabbix_server.conf” và thêm cấu hình dưới vào bất kỳ đâu trong file: StartPollers=100 StartPollersUnreachable=50 StartPingers=50 StartTrappers=10 StartDiscoverers=15 StartPreprocessors=15 StartHTTPPollers=5 StartAlerters=5 StartTimers=2 StartEscalators=2 CacheSize=128M HistoryCacheSize=64M HistoryIndexCacheSize=32M TrendCacheSize=32M ValueCacheSize=256M Lưu và thoát file (&nbsp;ctrl&nbsp;+&nbsp;x&nbsp;, tiếp theo là&nbsp;&nbsp;y&nbsp;&nbsp;và&nbsp;&nbsp;enter&nbsp;). Bước 3: Tối ưu hóa MySQL/MariaDB database a. Tạo file cấu hình MySQL Tạo file “10_my_tweaks.cnf”&nbsp;bằng lệnh “nano /etc/my.cnf.d/10_my_tweaks.cnf” và thêm cấu hình dưới vào: [mysqld] max_connections = 404 innodb_buffer_pool_size = 800M","url":"https://thu4nvd.github.io//zabbix-optimize/","@type":"BlogPosting","headline":"📯 Zabbix - Tối ưu hóa Zabbix + MySQL","dateModified":"2023-07-16T12:27:45+07:00","datePublished":"2022-10-05T05:36:00+07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://thu4nvd.github.io//zabbix-optimize/"},"@context":"https://schema.org"}</script><title>📯 Zabbix - Tối ưu hóa Zabbix + MySQL | Thu4nvd Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar-icon.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Thu4nvd Blog</a></div><div class="site-subtitle font-italic">Get In the Game</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/thu4nvd" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/thu4nvd" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['thuanvd','outlook.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span>📯 Zabbix - Tối ưu hóa Zabbix + MySQL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>📯 Zabbix - Tối ưu hóa Zabbix + MySQL</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> thu4nvd </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Oct 5, 2022, 5:36 AM +0700" prep="on" > Oct 5, 2022 <i class="unloaded">2022-10-05T05:36:00+07:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Jul 16, 2023, 12:27 PM +0700" prefix="Updated " > Jul 16 <i class="unloaded">2023-07-16T12:27:45+07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="951 words">5 min</span></div></div><div class="post-content"><p></p><p>Sau khi các bạn cài đặt Zabbix trên CentOS hoàn thành để cho hệ thống Zabbix server hoạt động với hiệu năng cao nhất thì các bạn cần thực hiện các bước tối ưu hóa Zabbix server và MySQL database.</p><p></p><p></p><p>Nếu chưa xem bài viết “Cài đặt Zabbix trên CentOS” thì các bạn tham khảo tại đây: <a href="https://thuanvu.me/zabbix-install" target="_blank" rel="noopener" title="Hướng dẫn cài đặt Zabbix.">Hướng dẫn cài đặt Zabbix.</a></p><p></p><p></p><p></p><h3>Hướng dẫn các bước tối ưu hóa Zabbix server và MySQL database</h3><p></p><p></p><figure class="wp-block-image"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/2022/10/Toi-uu-hoa-Zabbix-server-va-MySQL-database.png" alt="Tối ưu hóa Zabbix server và MySQL database" /></figure><p></p><p></p><h4><strong>Bước 1: Tạo phân vùng MySQL trên Lịch sử và bảng Sự kiện</strong></h4><p></p><p></p><p>Quy trình housekeeping của Zabbix chịu trách nhiệm xóa dữ liệu lịch sử. Xóa dữ liệu cũ khỏi database bằng cách sử dụng truy vấn xóa SQL, hành động này tác động tiêu cực đến hiệu suất database, có thể sẽ nhận được thông báo “<strong><em>Zabbix housekeeper processes more than 75% busy</em></strong>” vì điều đó.</p><p></p><p></p><p>Vấn đề này có thể được giải quyết với việc phân vùng cơ sở dữ liệu. Phân vùng tạo ra các bảng cho mỗi giờ hoặc mỗi ngày và loại bỏ chúng khi không cần thiết. <strong>SQL DROP hiệu quả hơn câu lệnh DELETE.</strong></p><p></p><p></p><p>Bạn có thể phân vùng các bảng MySQL bằng cách sử dụng&nbsp;hướng dẫn đơn giản này:</p><p></p><p></p><p><a href="https://thuanvu.me/zabbix-mariadb-repartition" target="_blank" rel="noopener">Tạo phân vùng database Zabbix trên MySQL MariaDB</a></p><p></p><p></p><h4><strong>Bước 2: Tối ưu hóa Zabbix Server</strong></h4><p></p><p></p><p>Nếu bạn đang vận hành với số lượng ít thiết bị thì bạn có thể bỏ qua bước này, còn nếu hệ thống của bạn lớn bao gồm nhiều thiết bị thì tiếp tục thực hiện tiếp nào.</p><p></p><p></p><p>Mở&nbsp;file “zabbix_server.conf” bằng lệnh “ nano /etc/zabbix/zabbix_server.conf” và thêm cấu hình dưới vào bất kỳ đâu trong file:</p><p></p><p></p><pre class="wp-block-preformatted">StartPollers=100
StartPollersUnreachable=50
StartPingers=50
StartTrappers=10
StartDiscoverers=15
StartPreprocessors=15
StartHTTPPollers=5
StartAlerters=5
StartTimers=2
StartEscalators=2
CacheSize=128M
HistoryCacheSize=64M
HistoryIndexCacheSize=32M
TrendCacheSize=32M
ValueCacheSize=256M</pre><p></p><p></p><p>Lưu và thoát file (&nbsp;<strong>ctrl</strong>&nbsp;+&nbsp;<strong>x</strong>&nbsp;, tiếp theo là&nbsp;&nbsp;<strong>y</strong>&nbsp;&nbsp;và&nbsp;&nbsp;<strong>enter</strong>&nbsp;).</p><p></p><p></p><h4><strong>Bước 3: Tối ưu hóa MySQL/MariaDB database</strong></h4><p></p><p></p><p><strong>a. Tạo file cấu hình MySQL</strong></p><p></p><p></p><p>Tạo file “10_my_tweaks.cnf”&nbsp;bằng lệnh “nano /etc/my.cnf.d/10_my_tweaks.cnf” và thêm cấu hình dưới vào:</p><p></p><p></p><pre class="wp-block-preformatted">[mysqld]
max_connections = 404
<strong>innodb_buffer_pool_size = 800M</strong>

innodb-log-file-size = 128M
innodb-log-buffer-size = 128M
innodb-file-per-table = 1
innodb_buffer_pool_instances = 8
innodb_old_blocks_time = 1000
innodb_stats_on_metadata = off
innodb-flush-method = O_DIRECT
innodb-log-files-in-group = 2
innodb-flush-log-at-trx-commit = 2

tmp-table-size = 96M
max-heap-table-size = 96M
open_files_limit = 65535
<strong>max_connect_errors</strong> = 1000000
connect_timeout = 60
wait_timeout = 28800</pre><p></p><p></p><p>Lưu và thoát khỏi file ( <strong>ctrl</strong> + <strong>x</strong> , theo sau là  <strong>y</strong>  và  <strong>enter</strong> ) và phân lại quyền đối với file bằng lệnh</p><p></p><p></p><pre class="wp-block-preformatted">chown mysql:mysql /etc/my.cnf.d/10_my_tweaks.cnf
chmod 644 /etc/my.cnf.d/10_my_tweaks.cnf</pre><p></p><p></p><p><strong>Hai điều cần lưu ý:</strong></p><p></p><p></p><p>Tham số cấu hình&nbsp;&nbsp;<a href="https://dev.mysql.com/doc/refman/5.5/en/server-system-variables.html#sysvar_max_connections" target="_blank" rel="noreferrer noopener"><strong>max_connections</strong></a>&nbsp;&nbsp;phải lớn hơn tổng số của tất cả các quy trình Zabbix proxy +150. Bạn có thể sử dụng lệnh bên dưới để tự động kiểm tra số lượng quy trình Zabbix và + thêm 150 vào số đó:</p><p></p><p></p><pre class="wp-block-preformatted">egrep "^Start.+=[0-9]" /etc/zabbix/zabbix_server.conf | awk -F "=" '{s+=$2} END {print s+150}'
295</pre><p></p><p></p><p>Tham số quan trọng thứ hai là&nbsp;&nbsp;<strong><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_buffer_pool_size" target="_blank" rel="noreferrer noopener">innodb_buffer_pool_size</a></strong>&nbsp;, xác định dung lượng bộ nhớ mà MySQL có thể lấy để lưu vào bộ nhớ đệm các bảng InnoDB và dữ liệu chỉ mục.&nbsp;Bạn nên đặt tham số đó thành 70% bộ nhớ hệ thống nếu chỉ có database được cài đặt trên máy server.</p><p></p><p></p><p>Tuy nhiên, trong trường hợp này, mình có đồng thời Zabbix và Apache, vì vậy mình đặt  <strong>innodb_buffer_pool_size </strong> thành 40% tổng bộ nhớ hệ thống. Đó sẽ là 800 MB vì ​​máy CentOS của mình có RAM 2 GB.</p><p></p><p></p><p>Mình không gặp bất kỳ sự cố nào với bộ nhớ, nhưng nếu Zabbix proxy của bạn bị treo vì thiếu bộ nhớ, hãy giảm “innodb_buffer_pool_size” và khởi động lại máy chủ MySQL.</p><p></p><p></p><p>Lưu ý rằng nếu bạn làm theo cấu hình này, bạn sẽ nhận được cảnh báo “<strong><em>Too many processes on the Zabbix server”</em></strong> trong giao diện người dùng của Zabbix do cấu hình Zabbix mới, nhưng không sao nó tuyệt đối không có lỗi gì. Để tăng ngưỡng kích hoạt hoặc tắt báo thức đó (chọn “ <em>Problems</em> ” → chuột trái vào alarm → chọn “<em>Configuration</em> ” → bỏ chọn “ <em>Enabled</em> ” → nhấn nút “ <em>Update</em>”)</p><p></p><p></p><p><strong>b.&nbsp;Khởi động lại Zabbix và MySQL</strong></p><p></p><p></p><pre class="wp-block-preformatted">systemctl stop zabbix-server
systemctl stop mysql
systemctl start mysql
systemctl start zabbix-server</pre><p></p><p></p><h4><strong>Bước 4: Kích hoạt cấu hình SELinux trên Zabbix</strong></h4><p></p><p></p><p>Cấu hình SElinux để cho phép Zabbix hoạt động, SElinux vẫn sẽ ghi lại tất cả các lỗi bảo mật nhưng sẽ không chặn bất cứ thứ gì liên quan đến Zabbix.</p><p></p><p></p><p><strong>a. Cho phép http daemon kết nối tới Zabbix</strong></p><p></p><p></p><pre class="wp-block-preformatted">setsebool -P httpd_can_connect_zabbix 1</pre><p></p><p></p><p><strong>b. Cho phép Zabbix kết nối với tất cả các cổng TCP</strong></p><p></p><p></p><pre class="wp-block-preformatted">setsebool -P zabbix_can_network 1</pre><p></p><p></p><p><strong>c. Đặt SELinux hoạt động ở chế độ thực thi</strong></p><p></p><p></p><pre class="wp-block-preformatted">setenforce 1 &amp;&amp; sed -i 's/^SELINUX=.*/SELINUX=enforcing/g' /etc/selinux/config</pre><p></p><p></p><p>Kiểm tra trạng thái SELinux</p><p></p><p></p><pre class="wp-block-preformatted"><strong># sestatus</strong>
SELinux status: enabled
SELinuxfs mount: /sys/fs/selinux
SELinux root directory: /etc/selinux
Loaded policy name: targeted
Current mode: <strong>enforcing</strong>
Mode from config file: enforcing
Policy MLS status: enabled
Policy deny_unknown status: allowed
Memory protection checking: actual (secure)
Max kernel policy version: 31</pre><p></p><p></p><p><strong>d. Tạo chính sách SELINUX bổ sung cho Zabbix</strong></p><p></p><p></p><p>Để đề phòng, ta sẽ tạo chính sách SELinux bổ sung cho từng lỗi trong log kiểm tra (“ /var/log/audit/audit.log“)</p><p></p><p></p><p>Chúng ta sẽ cần công cụ Policycoreutils-python, vì vậy hãy cài đặt nó:</p><p></p><p></p><pre class="wp-block-preformatted">dnf -y install policycoreutils-python-utils</pre><p></p><p></p><p>Tạo gói chính sách tùy chỉnh:</p><p></p><p></p><pre class="wp-block-preformatted">grep "denied.*zabbix" /var/log/audit/audit.log | audit2allow -M zabbix_policy</pre><p></p><p></p><p>Cài đặt gói chính sách SELinux tùy chỉnh:</p><p></p><p></p><pre class="wp-block-preformatted">semodule -i zabbix_policy.pp</pre><p></p><p></p><p>Bạn đã cấu hình xong SELinux cho Zabbix!</p><p></p><p></p><h4><strong>Bước 5: Nâng cấp các phiên bản Zabbix mới</strong></h4><p></p><p></p><p>Mục đích chính của các bản nâng cấp nhỏ là sửa lỗi và đôi khi mang lại chức năng mới.&nbsp;Do đó, hãy cố gắng nâng cấp Zabbix ít nhất mỗi tháng một lần.</p><p></p><p></p><pre class="wp-block-preformatted">dnf upgrade 'zabbix-*'</pre><p></p><p></p><p>Và khởi động lại Zabbix server sau đó:</p><p></p><p></p><pre class="wp-block-preformatted">systemctl restart zabbix-server</pre><p></p><p></p><p>Như vậy bạn đã thực hiện xong các bước tối ưu hóa Zabbix server và MySQL database. Felicitation !</p><p></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/linux/'>Linux</a>, <a href='/categories/system/'>System</a>, <a href='/categories/tools/'>Tools</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/monitoring/" class="post-tag no-text-decoration" >monitoring</a> <a href="/tags/optimize/" class="post-tag no-text-decoration" >optimize</a> <a href="/tags/zabbix/" class="post-tag no-text-decoration" >zabbix</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=📯 Zabbix - Tối ưu hóa Zabbix + MySQL - Thu4nvd Blog&url=https://thu4nvd.github.io//zabbix-optimize/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=📯 Zabbix - Tối ưu hóa Zabbix + MySQL - Thu4nvd Blog&u=https://thu4nvd.github.io//zabbix-optimize/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=📯 Zabbix - Tối ưu hóa Zabbix + MySQL - Thu4nvd Blog&url=https://thu4nvd.github.io//zabbix-optimize/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/linux-source-install/">🐧 Linux - Cài phần mềm từ source</a><li><a href="/nas-synology/">🧺 NAS Synology - Thiết bị lưu trữ dữ liệu</a><li><a href="/prometheus-install/">🔥 Prometheus - Cài đặt + Grafana / CentOS 7</a><li><a href="/wget/">🐧 wget - commands with examples</a><li><a href="/centreon-install-iso/">© Centreon - Cài đặt Centreon 19 ISO💿</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/travel/">travel</a> <a class="post-tag" href="/tags/xuyenviet/">xuyenviet</a> <a class="post-tag" href="/tags/cameroun/">cameroun</a> <a class="post-tag" href="/tags/french/">french</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/skill/">skill</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/dns/">dns</a> <a class="post-tag" href="/tags/howto/">howto</a> <a class="post-tag" href="/tags/zabbix/">zabbix</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/zabbix-cli/"><div class="card-body"> <span class="timeago small" > Oct 8, 2022 <i class="unloaded">2022-10-08T22:17:59+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>📯 Zabbix - Command lines</h3><div class="text-muted small"><p> Thuận giới thiệu một vài commands thường dùng (daily) trên zabbix-server: systemctl status zabbix-servertop # filter by user zabbixps u -C zabbix_agentd #process zabbixzabbix_server -V #versionz...</p></div></div></a></div><div class="card"> <a href="/zabbix-install/"><div class="card-body"> <span class="timeago small" > Oct 3, 2022 <i class="unloaded">2022-10-03T16:38:00+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>📯 Zabbix - Các bước cài đặt lên CentOS 8</h3><div class="text-muted small"><p> Zabbix server có thể cài đặt trên bất kỳ bản Linux nào. Trong hướng dẫn này Thuận sẽ hướng dẫn bạn cài đặt&nbsp;bản Zabbix 5.0 LTS&nbsp;hoặc&nbsp;Zabbix 5.4 Standard&nbsp;trên CentOS 8/ RHEL 8/ ...</p></div></div></a></div><div class="card"> <a href="/prometheus-install/"><div class="card-body"> <span class="timeago small" > Oct 13, 2022 <i class="unloaded">2022-10-13T12:52:08+07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>🔥 Prometheus - Cài đặt + Grafana / CentOS 7</h3><div class="text-muted small"><p> Trong bài này mình sẽ hướng dẫn các bạn cài đặt Prometheus và Grafana bằng 2 cách. Cách 01: Cài đặt Prometheus bằng Docker. Cách 02: Cài đặt Prometheus bằng Package. I. Cấu hình chung cho h...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/%f0%9f%90%be-point-of-knowledge-footer/" class="btn btn-outline-primary" prompt="Older"><p>Point of Knowledge - Footer</p></a> <a href="/polyphasic-sleep/" class="btn btn-outline-primary" prompt="Newer"><p>😴 Polyphasic Sleep – Chuyển tiếp mượt mà</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/thu4nvd">Richard Thu4nvd</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."> Some rights reserved. </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/travel/">travel</a> <a class="post-tag" href="/tags/xuyenviet/">xuyenviet</a> <a class="post-tag" href="/tags/cameroun/">cameroun</a> <a class="post-tag" href="/tags/french/">french</a> <a class="post-tag" href="/tags/monitoring/">monitoring</a> <a class="post-tag" href="/tags/skill/">skill</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/dns/">dns</a> <a class="post-tag" href="/tags/howto/">howto</a> <a class="post-tag" href="/tags/zabbix/">zabbix</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://thu4nvd.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
